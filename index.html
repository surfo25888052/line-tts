<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>盲人導讀師 (LINE 連動版)</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
textarea { resize: none; }
</style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">
<main class="w-full max-w-2xl bg-gray-800 rounded-2xl p-6 shadow-lg">
  <h1 class="text-3xl font-bold text-center mb-4">盲人導讀師</h1>
  
  <div class="mb-4">
    <textarea id="msgArea" rows="8" class="w-full p-4 bg-gray-700 rounded-lg text-lg" readonly placeholder="等待 LINE 訊息..."></textarea>
  </div>
  
  <div class="flex gap-4 mb-4">
    <button id="readBtn" class="flex-1 bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-bold flex items-center justify-center">
      重讀一次
    </button>
    <button id="stopBtn" class="flex-1 bg-red-600 hover:bg-red-700 py-3 rounded-lg font-bold flex items-center justify-center">
      停止朗讀
    </button>
  </div>

  <p id="status" class="text-center text-gray-300 h-6"></p>
</main>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbxeMfXVE-EX-EYclDvIygXy55SGiQxxws4g6zbgLosUD5b9lcB2UUeNIMIwEniY8cQifQ/exec"; // ← 改成你的 Web App URL
const msgArea = document.getElementById("msgArea");
const readBtn = document.getElementById("readBtn");
const stopBtn = document.getElementById("stopBtn");
const status = document.getElementById("status");

let latestText = "";

// 朗讀函式
function speak(text){
  if(!('speechSynthesis' in window)){ status.textContent="瀏覽器不支援 TTS"; return; }
  window.speechSynthesis.cancel();
  if(text.trim()===""){ status.textContent="無內容可朗讀"; return; }
  const u = new SpeechSynthesisUtterance(text);
  u.lang="zh-TW";
  u.rate=1;
  u.pitch=1;
  u.onstart=()=>{ status.textContent="朗讀中..."; readBtn.disabled=true; };
  u.onend=()=>{ status.textContent=""; readBtn.disabled=false; };
  window.speechSynthesis.speak(u);
}

// 停止朗讀
stopBtn.onclick = ()=>window.speechSynthesis.cancel();
readBtn.onclick = ()=>speak(latestText);

// 定時抓最新訊息
async function fetchMessage(){
  try{
    const res = await fetch(GAS_URL);
    const data = await res.json();
    if(data.error){ status.textContent=data.error; return; }
    const text = `[${new Date(data.timestamp).toLocaleString()}]\n${data.text}`;
    if(latestText !== data.text){ // 新訊息才更新
      latestText = data.text;
      msgArea.value = text;
      speak(latestText);
    }
  }catch(err){
    console.error(err);
    status.textContent="取得訊息失敗";
  }
}

// 每 5 秒抓一次
setInterval(fetchMessage,5000);
fetchMessage();
</script>

</body>
</html>
